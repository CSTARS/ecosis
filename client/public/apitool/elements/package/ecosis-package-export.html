<dom-module id="ecosis-package-export">
  <style>
    :host {
      display: block;
    }
  </style>

  <template>
    <h4 class="page-header">/package/export</h4>
    <div class="help-block">
      Export package as CSV file.  You must provide either the package_id or the package_name.
    </div>

    <h5>Parameters</h5>

    <div class="form-horizontal">

      <div class="form-group">
        <label for="filtersInput" class="col-lg-2 control-label">package_id</label>
        <div class="col-lg-10">
          <input id="idInput" type="text" class="form-control" on-input="onInputId"/>
          <div class="help-block">EcoSIS package id</div>
        </div>
      </div>

      <div class="form-group">
        <label for="filtersInput" class="col-lg-2 control-label">package_name</label>
        <div class="col-lg-10">
          <input id="nameInput" type="text" class="form-control" on-input="onInputName"/>
          <div class="help-block">EcoSIS package name</div>
        </div>
      </div>

      <div class="form-group">
        <label for="filtersInput" class="col-lg-2 control-label"></label>
        <div class="col-lg-10">
          <label>
            <input type="checkbox" id="includeMetadata" on-change="onInputMetadata"> Include Metadata
          </label>
          <div class="help-block">Should the CSV file include the spectra metadata?</div>
        </div>
      </div>

    </div>

    <h5>Export url</h5>
    <div id="preview"></div>

  </template>
</dom-module>

<script>
  Polymer({
    is : 'ecosis-package-export',

    onInputId : function(e) {
      this.$.nameInput.value = '';
      var id = this.$.idInput.value;
      var url = HOST+'/package/export?id='+id+this.includeMetadata();

      this.$.preview.innerHTML = '<a href="'+url+'" target="_blank">'+url+'</a>';
    },

    onInputName : function(e) {
      this.$.idInput.value = '';
      var id = this.$.nameInput.value;
      var url = HOST+'/package/export?package_name='+id+this.includeMetadata();

      this.$.preview.innerHTML = '<a href="'+url+'" target="_blank">'+url+'</a>';
    },

    onInputMetadata : function() {
      if( this.$.idInput.value ) {
        this.onInputId();
      } else if ( this.$.nameInput.value ) {
        this.onInputName();
      }
    },

    includeMetadata : function() {
      if( $(this.$.includeMetadata).is(':checked') ) {
        return '&includeMetadata=true';
      }
      return '';
    }
  });
</script>
